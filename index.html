<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <title>Åpne search:query</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; max-width: 640px; margin: 6vh auto; padding: 16px; }
    label, input, button { font-size: 16px; }
    .row { display: flex; gap: 8px; align-items: center; margin-top: 12px; }
    input[type="text"] { flex: 1; padding: 10px; }
    button { padding: 10px 16px; cursor: pointer; }
    .hint { color: #555; margin-top: 6px; font-size: 14px; }
    .error { color: #b00020; margin-top: 8px; }
    .uri-preview { margin-top: 12px; font-family: monospace; }
  </style>
</head>
<body>
  <h1>Åpne search:query</h1>

  <p>Skriv inn et telefonnummer (8 sifre). Det åpnes som <code>search:query=NUMMER</code>.</p>

  <div class="row">
    <label for="phone">Telefon:</label>
    <input id="phone" type="text" inputmode="numeric" maxlength="8" placeholder="f.eks. 47910303" />
    <button id="openBtn" type="button">Åpne</button>
  </div>
  <div class="hint">Tips: Legg til <code>?n=47910303</code> i adressen for auto-åpning.</div>

  <div id="error" class="error" style="display:none;"></div>
  <div class="uri-preview" id="preview" style="display:none;">
    URI: <a id="uriLink" href="#">(forhåndsvisning)</a>
  </div>

  <script>
    function onlyDigits(str) {
      return (str || "").replace(/\D+/g, "");
    }

    function isEightDigits(str) {
      return /^\d{8}$/.test(str);
    }

    function buildURI(number8) {
      return "search:query=" + number8;
    }

    function showError(msg) {
      const el = document.getElementById("error");
      el.textContent = msg;
      el.style.display = msg ? "block" : "none";
    }

    function updatePreview(number8) {
      const prev = document.getElementById("preview");
      const link = document.getElementById("uriLink");
      if (isEightDigits(number8)) {
        const href = buildURI(number8);
        link.href = href;
        link.textContent = href;
        prev.style.display = "block";
      } else {
        prev.style.display = "none";
      }
    }

    function openURI(number8) {
      if (!isEightDigits(number8)) {
        showError("Ugyldig nummer. Skriv nøyaktig 8 sifre.");
        updatePreview("");
        return;
      }
      showError("");
      const href = buildURI(number8);
      updatePreview(number8);
      window.location.href = href;
    }

    document.getElementById("openBtn").addEventListener("click", () => {
      const digits = onlyDigits(document.getElementById("phone").value);
      openURI(digits);
    });

    document.getElementById("phone").addEventListener("input", (e) => {
      const digits = onlyDigits(e.target.value);
      if (e.target.value !== digits) e.target.value = digits;
      updatePreview(digits);
      showError("");
    });

    document.getElementById("phone").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        const digits = onlyDigits(e.target.value);
        openURI(digits);
      }
    });

    // Auto-åpne hvis ?n= finnes
    (functi
